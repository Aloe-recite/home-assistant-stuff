type: custom:mod-card
card:
  type: vertical-stack
  cards:
    - type: conditional
      conditions:
        - condition: state
          entity: input_boolean.lavatrice_terminata
          state: "on"
      card:
        type: custom:bubble-card
        card_type: button
        entity: input_boolean.lavatrice_terminata
        button_type: state
        name: ""
        icon: mdi:washing-machine
        show_state: false
        attribute: editable
        sub_button:
          - name: time
            entity: sensor.notifica_lavatrice_tempo
            show_state: true
            show_icon: false
            show_background: false
            state_background: false
            tap_action:
              action: none
          - entity: input_boolean.lavatrice_terminata
            name: Close
            icon: mdi:close
            show_background: true
            state_background: false
            tap_action:
              action: toggle
        event_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        tap_action:
          action: none
        button_action:
          tap_action:
            action: none
        styles: >-
          .bubble-icon {
            color: var(--primary-text-color) !important;
            fill: var(--primary-text-color) !important; /* per SVG */
          }

          .bubble-icon-container {
            background-color: rgba(60, 179, 113, 0.45) !important;
          }

          .bubble-container {
            background-color: var(--card-background-color, #fff) !important;
            border: 1px solid var(--ha-card-border-color,var(--divider-color,#e0e0e0));
          }

          .bubble-container:hover {
            background-color: var(--bubble-button-main-background-color,
              var(--bubble-main-background-color,
              var(--background-color-2,
              var(--secondary-background-color)))) !important;
            cursor: pointer;
          }

          .bubble-sub-button-2, .bubble-sub-button-3 {
            filter: invert(5%);
            transition: filter 0.2s ease;
          }

          .bubble-container:hover .bubble-sub-button-2, .bubble-container:hover
          .bubble-sub-button-3 {
            filter: none;
          }
    - type: conditional
      conditions:
        - condition: state
          entity: input_boolean.notifica_lavastoviglie_terminata
          state: "on"
      card:
        type: custom:bubble-card
        card_type: button
        entity: input_boolean.notifica_lavastoviglie_terminata
        button_type: state
        name: ""
        icon: mdi:washing-machine
        show_state: false
        attribute: editable
        sub_button:
          - name: time
            entity: sensor.notifica_lavastoviglie_tempo
            show_state: true
            show_icon: false
            show_background: false
            state_background: false
            tap_action:
              action: none
          - entity: input_boolean.notifica_lavastoviglie_terminata
            name: Close
            icon: mdi:close
            show_background: true
            state_background: false
            tap_action:
              action: toggle
        event_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        tap_action:
          action: none
        button_action:
          tap_action:
            action: none
        styles: >-
          .bubble-icon {
            color: var(--primary-text-color) !important;
            fill: var(--primary-text-color) !important; /* per SVG */
          } .bubble-icon-container {
            background-color: rgba(60, 179, 113, 0.45) !important;
          }

          .bubble-container {
            background-color: var(--card-background-color, #fff) !important;
            border-radius: 9999px !important;            
            border: 1px solid var(--ha-card-border-color,var(--divider-color,#e0e0e0));
          }

          .bubble-container:hover {
            background-color: var(--bubble-button-main-background-color,
              var(--bubble-main-background-color,
              var(--background-color-2,
              var(--secondary-background-color)))) !important;
            cursor: pointer;
          }

          .bubble-sub-button-2, .bubble-sub-button-3 {
            filter: invert(5%);
            transition: filter 0.2s ease;
          }

          .bubble-container:hover .bubble-sub-button-2, .bubble-container:hover
          .bubble-sub-button-3 {
            filter: none;
          }
    - type: conditional
      conditions:
        - condition: state
          entity: input_boolean.notifica_server
          state: "on"
        - condition: state
          entity: binary_sensor.ups_non_su_rete
          state: "off"
      card:
        type: custom:bubble-card
        card_type: button
        entity: input_boolean.notifica_server
        button_type: state
        name: Rilevato problema al server
        icon: mdi:server-network-off
        show_state: false
        attribute: editable
        modules:
          - badges
        badges:
          main_icon:
            badge_1:
              icon: mdi:exclamation-thick
              color: orange
        sub_button:
          - name: time
            entity: sensor.notifica_server_warning_tempo
            show_state: true
            show_icon: false
            show_background: false
            state_background: false
            tap_action:
              action: none
          - name: link
            show_state: false
            show_icon: true
            icon: mdi:magnify
            show_background: true
            state_background: false
            tap_action:
              action: navigate
              navigation_path: /dashboard-mobile/server-rack
          - entity: input_boolean.notifica_server
            name: Close
            icon: mdi:close
            show_background: true
            state_background: false
            tap_action:
              action: toggle
        event_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        tap_action:
          action: none
        button_action:
          tap_action:
            action: none
        styles: >-
          .bubble-icon {
            color: var(--primary-text-color) !important;
            fill: var(--primary-text-color) !important; /* per SVG */
          }

          .bubble-icon-container {
            background-color: rgba(255, 152, 0, 0.65) !important;
          }

          .bubble-container {
            background-color: var(--card-background-color, #fff) !important;
            border: 1px solid var(--ha-card-border-color,var(--divider-color,#e0e0e0));
          }

          .bubble-container:hover {
            background-color: var(--bubble-button-main-background-color,
              var(--bubble-main-background-color,
              var(--background-color-2,
              var(--secondary-background-color)))) !important;
            cursor: pointer;
          }

          .bubble-sub-button-2, .bubble-sub-button-3 {
            filter: invert(5%);
            transition: filter 0.2s ease;
          }

          .bubble-container:hover .bubble-sub-button-2, .bubble-container:hover
          .bubble-sub-button-3 {
            filter: none;
          }
    - type: conditional
      conditions:
        - condition: state
          entity: binary_sensor.ups_non_su_rete
          state: "on"
      card:
        type: custom:bubble-card
        card_type: button
        entity: binary_sensor.ups_non_su_rete
        button_type: state
        name: UPS su batteria
        icon: mdi:power-plug-off
        show_state: false
        attribute: editable
        modules:
          - badges
        badges:
          main_icon:
            badge_1:
              icon: mdi:lightning-bolt
              color: orange
        sub_button:
          - name: Load
            entity: sensor.eaton_ups_carica_batterie
            show_state: true
            show_icon: true
            icon: mdi:battery-50
            show_name: false
            show_background: false
            state_background: false
            tap_action:
              action: none
          - name: Time on battery
            entity: sensor.eaton_ups_autonomia_della_batteria
            show_state: true
            show_icon: true
            icon: mdi:battery-clock-outline
            show_name: false
            show_background: false
            tap_action:
              action: none
          - name: link
            show_state: false
            show_icon: true
            icon: mdi:magnify
            show_background: true
            state_background: false
            tap_action:
              action: navigate
              navigation_path: /dashboard-mobile/server-rack
        event_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        tap_action:
          action: none
        button_action:
          tap_action:
            action: none
        styles: >-
          .bubble-icon {
            color: var(--primary-text-color) !important;
            fill: var(--primary-text-color) !important; /* per SVG */
          } .bubble-icon-container {
            background-color: rgba(255, 152, 0, 0.65) !important;
          }

          .bubble-container {
            background-color: var(--card-background-color, #fff) !important;
            border: 1px solid var(--ha-card-border-color,var(--divider-color,#e0e0e0));
          }

          .bubble-container:hover {
            background-color: var(--bubble-button-main-background-color,
              var(--bubble-main-background-color,
              var(--background-color-2,
              var(--secondary-background-color)))) !important;
            cursor: pointer;
          }

          .bubble-sub-button-2, .bubble-sub-button-3 {
            filter: invert(5%);
            transition: filter 0.2s ease;
          }

          .bubble-container:hover .bubble-sub-button-2, .bubble-container:hover
          .bubble-sub-button-3 {
            filter: none;
          } ${subButtonIcon[0].setAttribute(
            "icon",
            hass.states['sensor.eaton_ups_carica_batterie'].state === '100' ? 'mdi:battery-charging-outline' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '90' ? 'mdi:battery-90' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '80' ? 'mdi:battery-80' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '70' ? 'mdi:battery-70' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '60' ? 'mdi:battery-60' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '50' ? 'mdi:battery-50' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '40' ? 'mdi:battery-40' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '30' ? 'mdi:battery-30' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '20' ? 'mdi:battery-20' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '10' ? 'mdi:battery-10' :
            hass.states['sensor.eaton_ups_carica_batterie'].state === '0'  ? 'mdi:battery-alert-variant-outline' :
            'mdi:battery-unknown'
          )}
    - type: conditional
      conditions:
        - condition: state
          entity: binary_sensor.water_leak_lavanderia_water_leak
          state: "on"
      card:
        type: custom:bubble-card
        card_type: button
        entity: binary_sensor.water_leak_lavanderia_water_leak
        button_type: state
        name: Perdita di acqua in lavanderia
        icon: mdi:water
        show_state: false
        attribute: editable
        modules:
          - badges
        badges:
          main_icon:
            badge_1:
              icon: mdi:exclamation-thick
              color: red
        sub_button:
          - name: time
            entity: sensor.notifica_perdita_acqua_lavanderia_tempo
            show_state: true
            show_icon: false
            show_background: false
            state_background: false
            tap_action:
              action: none
        event_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        tap_action:
          action: none
        button_action:
          tap_action:
            action: none
        styles: >-
          .bubble-icon {
            color: var(--primary-text-color) !important;
            fill: var(--primary-text-color) !important; /* per SVG */
          } .bubble-icon-container {
            background-color: rgba(255, 0, 0, 0.55) !important;
          }

          .bubble-container {
            background-color: var(--card-background-color, #fff) !important;
            border: 1px solid var(--ha-card-border-color,var(--divider-color,#e0e0e0));
          }

          .bubble-container:hover {
            background-color: var(--bubble-button-main-background-color,
              var(--bubble-main-background-color,
              var(--background-color-2,
              var(--secondary-background-color)))) !important;
            cursor: pointer;
          }

          .bubble-sub-button-2, .bubble-sub-button-3 {
            filter: invert(5%);
            transition: filter 0.2s ease;
          }

          .bubble-container:hover .bubble-sub-button-2, .bubble-container:hover
          .bubble-sub-button-3 {
            filter: none;
          }
grid_options:
  columns: 24
  rows: auto
card_mod:
  style: |
    ha-card {
      padding-top: 10px;
    }
    hui-vertical-stack-card$: |
      hui-card {
        position: relative;
        border-radius: 20px;
        transition: all 0.3s ease;
        border-radius: 9999px !important
      }
      /* Stacked (only when next card is visible) */
      hui-card:not([hidden]) ~ hui-card:not([hidden]) {
        margin-top: -45px;
        box-shadow: 0 -5px 10px rgba(100,100,100,0.1);
        border-radius: 9999px;
      }
      /* Blur all but the last visible */
      hui-card:has(~ hui-card:not([hidden])) {
        filter: blur(0.6px);
      }
      /* The last/top visible card stays clear */
      hui-card:not(:has(~ hui-card:not([hidden]))) {
        filter: none;
        background: var(--card-background-color);
      }
      /* On hover/active â†’ unstack and clear ALL */
      :host(:hover) hui-card,
      :host(:active) hui-card {
        margin-top: 0 !important;
        box-shadow: none !important;
        filter: none !important;
      }
